<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ClearNext - AI Clarity Conversation</title>

<style>
body {
    margin: 0;
    font-family: 'Inter', sans-serif;
    background: linear-gradient(135deg, #eef2ff, #f8f9ff);
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

.container {
    background: white;
    width: 90%;
    max-width: 650px;
    height: 85vh;
    border-radius: 18px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.08);
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.header {
    padding: 20px;
    text-align: center;
    font-weight: 600;
    font-size: 18px;
    border-bottom: 1px solid #eee;
    background: #f8f9ff;
}

#chatBox {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
}

.message {
    margin-bottom: 15px;
    padding: 12px 15px;
    border-radius: 14px;
    max-width: 80%;
    font-size: 14px;
    line-height: 1.5;
}

.ai {
    background: #eef2ff;
    align-self: flex-start;
}

.user {
    background: #dbeafe;
    align-self: flex-end;
    text-align: right;
}

.input-area {
    display: flex;
    padding: 15px;
    border-top: 1px solid #eee;
    background: white;
}

input {
    flex: 1;
    padding: 12px;
    border-radius: 10px;
    border: 1px solid #ccc;
    font-size: 14px;
}

button {
    margin-left: 10px;
    padding: 12px 18px;
    border-radius: 10px;
    border: none;
    background: #4f46e5;
    color: white;
    cursor: pointer;
    font-weight: 500;
}

button:hover {
    background: #3730a3;
}

.progress {
    text-align: center;
    font-size: 12px;
    color: #666;
    padding: 8px;
}
</style>
</head>

<body>

<div class="container">
    <div class="header">
        ClearNext AI â€“ Clarity Initialization
    </div>

    <div id="chatBox"></div>

    <div class="progress" id="progressText"></div>

    <div class="input-area">
        <input type="text" id="userInput" placeholder="Type your answer...">
        <button onclick="sendMessage()">Send</button>
    </div>
</div>

<script>

// Conversation Questions
const questions = [
    "In one sentence, what is currently confusing you the most?",
    "When did this confusion begin?",
    "What are you most afraid might happen if you choose wrongly?",
    "Does this confusion make you feel stuck, anxious, or overwhelmed?",
    "What actions have you taken so far to solve this?",
    "If nothing changes, where do you see yourself in 3 months?"
];

let currentStep = 0;
let responses = {};

const chatBox = document.getElementById("chatBox");
const progressText = document.getElementById("progressText");

// Start Conversation
function startConversation() {
    appendMessage("ai", questions[currentStep]);
    updateProgress();
}

// Send Message
function sendMessage() {
    const input = document.getElementById("userInput");
    const text = input.value.trim();

    if (text === "") return;

    appendMessage("user", text);
    responses["Q" + currentStep] = text;

    input.value = "";
    currentStep++;

    if (currentStep < questions.length) {
        setTimeout(() => {
            appendMessage("ai", questions[currentStep]);
            updateProgress();
        }, 700);
    } else {
        endConversation();
    }
}

// End Conversation
function endConversation() {

    localStorage.setItem("clarityData", JSON.stringify(responses));

    appendMessage("ai", "Thank you for your honesty.");
    
    setTimeout(() => {
        appendMessage("ai", "Your clarity journey has been prepared.");
    }, 1000);

    setTimeout(() => {
        redirectToJourney();
    }, 2000);
}

// Redirect Based on Selected Journey
function redirectToJourney() {

    let selectedDays = localStorage.getItem("journeyDays");

    if (selectedDays === "7") {
        window.location.href = "7day.html";
    } else if (selectedDays === "14") {
        window.location.href = "14day.html";
    } else if (selectedDays === "21") {
        window.location.href = "21day.html";
    } else {
        // default fallback
        window.location.href = "7day.html";
    }
}

// Append Messages
function appendMessage(type, text) {
    const div = document.createElement("div");
    div.classList.add("message", type);
    div.innerText = text;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
}

// Update Progress
function updateProgress() {
    progressText.innerText = 
        "Step " + (currentStep + 1) + " of " + questions.length;
}

// Enter key support
document.getElementById("userInput").addEventListener("keypress", function(e) {
    if (e.key === "Enter") {
        sendMessage();
    }
});

window.onload = startConversation;

</script>

</body>
</html>
